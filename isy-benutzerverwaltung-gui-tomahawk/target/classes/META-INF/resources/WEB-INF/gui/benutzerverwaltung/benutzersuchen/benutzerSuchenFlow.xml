<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.springframework.org/schema/webflow"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.4.xsd"
      parent="applikationseiteParentFlow">

    <secured attributes="Benutzerverwaltung.Benutzer.Suchen,Benutzerverwaltung.Benutzer.Loeschen"/>

    <var name="benutzerSuchenModel"
         class="de.bund.bva.isyfact.benutzerverwaltung.gui.benutzerverwaltung.benutzersuchen.BenutzerSuchenModel"/>
         
    <on-start>
        <evaluate expression="benutzerSuchenController.initialisiereModel(benutzerSuchenModel)"/>
    </on-start>
    
    <view-state id="benutzerSuchenViewState" model="benutzerSuchenModel">
        <attribute name="breadcrumbTitelSchluessel" value="MEL_Breadcrumb_Benutzer_suchen"/>
                
        <transition on="filterZuruecksetzen">
	        <evaluate
	        	expression="benutzerSuchenController.filterZuruecksetzen(benutzerSuchenModel)"/>
	    </transition>

        <transition on="suche" to="benutzerSuchenTrefferlisteViewState">
        	<evaluate expression="benutzerSuchenController.suche(benutzerSuchenModel)"/>
        </transition>
    </view-state>
    
    <view-state id="benutzerSuchenTrefferlisteViewState">   
        <transition on="filterZuruecksetzen">
	        <evaluate
	        	expression="benutzerSuchenController.filterZuruecksetzen(benutzerSuchenModel)"/>
	    </transition>

        <transition on="suche">
        	<evaluate expression="benutzerSuchenController.suche(benutzerSuchenModel)"/>
        </transition>
    
        <transition on="bearbeiten" to="bearbeiteBenutzer"/>
        <transition on="loeschen" to="benutzerLoeschenDialogViewState"/>
        <transition on="passwortZuruecksetzen" to="passwortZuruecksetzen"/>
    </view-state>
    
    <view-state id="benutzerLoeschenDialogViewState" model="benutzerSuchenModel">
    	<var name="benutzer"
    		 class="de.bund.bva.isyfact.benutzerverwaltung.gui.benutzerverwaltung.model.BenutzerModel"/>
    		 
		<on-entry>
			<evaluate expression="basisController.showModalDialog()"/>
			<evaluate expression="benutzer = benutzerSuchenModel.ausgewaehlterTreffer"/>
		</on-entry>
		
		<transition on="loescheBenutzer" to="ueberpruefeBenutzerLoeschen"/>
				
		<transition on="schliesseModalenDialog" to="benutzerSuchenTrefferlisteViewState">
			<evaluate expression="basisController.hideModalDialog()"/>
		</transition>
	</view-state>
	
	<decision-state id="ueberpruefeBenutzerLoeschen">
		<if test="benutzerSuchenController.benutzerLoeschen(benutzerSuchenModel)" then="updateDisplayItems" else="benutzerLoeschenDialogViewState" />
	</decision-state>
	
	<action-state id="updateDisplayItems">
		<evaluate expression="benutzerSuchenController.updateDisplayItems(benutzerSuchenModel)"/>
		<transition on="success" to="benutzerSuchenTrefferlisteViewState" />
	</action-state>

    <subflow-state id="bearbeiteBenutzer" subflow="benutzerBearbeitenFlow">

        <input name="ausgewaehlterBenutzer"
               value="benutzerSuchenModel.ausgewaehlterTreffer"
               type="de.bund.bva.isyfact.benutzerverwaltung.gui.benutzerverwaltung.model.BenutzerModel"/>

        <transition on="end" to="benutzerSuchenViewState"/>
        
    </subflow-state>
    
	<subflow-state id="passwortZuruecksetzen" subflow="benutzerPasswortZuruecksetzenFlow">

        <input name="ausgewaehlterBenutzer"
               value="benutzerSuchenModel.ausgewaehlterTreffer"
               type="de.bund.bva.isyfact.benutzerverwaltung.gui.benutzerverwaltung.model.BenutzerModel"/>

        <transition on="end" to="benutzerSuchenTrefferlisteViewState"/>
        
    </subflow-state>
    

    <end-state id="end"/>
</flow>
