<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.springframework.org/schema/webflow"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.4.xsd"
      parent="applikationseiteParentFlow">

    <secured attributes="Benutzerverwaltung.Rolle.Suchen,Benutzerverwaltung.Rolle.Loeschen"/>

    <var name="rolleSuchenModel"
         class="de.bund.bva.isyfact.benutzerverwaltung.gui.rollenverwaltung.rollesuchen.RolleSuchenModel"/>
         
    <on-start>
        <evaluate expression="rolleSuchenController.initialisiereModel(rolleSuchenModel)"/>
    </on-start>
    
    <view-state id="rolleSuchenViewState" model="rolleSuchenModel">
        <attribute name="headlineKey" value="MAS_Rollenverwaltung_Headline"/>

        <transition on="filterZuruecksetzen">
            <evaluate expression="rolleSuchenController.filterZuruecksetzen(rolleSuchenModel)"/>
        </transition>

        <transition on="suchen" to="rolleSuchenTrefferlisteViewState">
        	<evaluate expression="rolleSuchenController.suche(rolleSuchenModel)"/>
        </transition>
    </view-state>

    <view-state id="rolleSuchenTrefferlisteViewState" model="rolleSuchenModel">
        <attribute name="headlineKey" value="MAS_Rollenverwaltung_Headline"/>

        <transition on="filterZuruecksetzen">
            <evaluate expression="rolleSuchenController.filterZuruecksetzen(rolleSuchenModel)"/>
        </transition>
        
        <transition on="suchen">
        	<evaluate expression="rolleSuchenController.suche(rolleSuchenModel)"/>
        </transition>
        
        <transition on="bearbeiten" to="bearbeiteRolle"/>
        <transition on="loeschen" to="rolleLoeschenDialogViewState"/>
    </view-state>
    
    <view-state id="rolleLoeschenDialogViewState">    	
    	<var name="rolle"
        	 class="de.bund.bva.isyfact.benutzerverwaltung.gui.benutzerverwaltung.model.RolleModel"/>
    		 
		<on-entry>
			<evaluate expression="basisController.showModalDialog()"/>
			<evaluate expression="rolle = rolleSuchenModel.ausgewaehlterTreffer"/>
		</on-entry>
		
		<transition on="loescheRolle" to="ueberpruefeRolleLoeschen"/>
		
		<transition on="schliesseModalenDialog" to="rolleSuchenTrefferlisteViewState">
			<evaluate expression="basisController.hideModalDialog()"/>
		</transition>
	</view-state>
	
	<decision-state id="ueberpruefeRolleLoeschen">		
		<if test="rolleSuchenController.rolleLoeschen(rolleSuchenModel)" then="updateDisplayItems" else="rolleLoeschenDialogViewState" />
	</decision-state>
	
	<action-state id="updateDisplayItems">
		<evaluate expression="rolleSuchenController.updateDisplayItems(rolleSuchenModel)" />
		<transition on="success" to="rolleSuchenTrefferlisteViewState" />
	</action-state>

    <subflow-state id="bearbeiteRolle" subflow="rolleBearbeitenFlow">
        <input name="ausgewaehlteRolle" value="rolleSuchenModel.ausgewaehlterTreffer"
               type="de.bund.bva.isyfact.benutzerverwaltung.gui.benutzerverwaltung.model.RolleModel"/>

        <transition on="end" to="rolleSuchenTrefferlisteViewState"/>
    </subflow-state>

    <end-state id="end"/>
</flow>
