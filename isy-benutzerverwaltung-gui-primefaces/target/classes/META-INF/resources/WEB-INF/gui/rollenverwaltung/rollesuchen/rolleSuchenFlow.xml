<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.springframework.org/schema/webflow"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"
      parent="applikationseiteParentFlow">

    <secured attributes="Benutzerverwaltung.Rolle.Suchen,Benutzerverwaltung.Rolle.Loeschen"/>

    <var name="rolleSuchenModel"
         class="de.bund.bva.isyfact.benutzerverwaltung.gui.rollenverwaltung.rollesuchen.RolleSuchenModel"/>

    <on-start>
        <evaluate expression="rolleSuchenController.initialisiereModel(rolleSuchenModel)"/>
    </on-start>

    <view-state id="suchenViewState" model="rolleSuchenModel">
        <attribute name="headlineKey" value="MAS_Rollenverwaltung_Headline"/>

        <transition on="filterZuruecksetzen" to="suchenViewState">
            <evaluate expression="rolleSuchenController.filterZuruecksetzen(rolleSuchenModel)"/>
        </transition>

        <transition on="suchen" to="trefferlisteViewState"/>
    </view-state>

    <view-state id="trefferlisteViewState" model="rolleSuchenModel">
        <attribute name="headlineKey" value="MAS_Rollenverwaltung_Headline"/>

        <on-entry>
            <evaluate expression="rolleSuchenController.zeigeSuchfehlerAn(rolleSuchenModel)"/>
        </on-entry>

        <transition on="filterZuruecksetzen" to="trefferlisteViewState">
            <evaluate expression="rolleSuchenController.filterZuruecksetzen(rolleSuchenModel)"/>
        </transition>
        <transition on="suchen" to="trefferlisteViewState"/>
        <transition on="bearbeiten" to="bearbeiteRolle"/>
        <transition on="zeigeLoeschDialog" to="trefferlisteViewState">
            <evaluate expression="basisController.showModalDialog()"/>
        </transition>
        <transition on="loeschen" to="trefferlisteViewState">
            <evaluate expression="basisController.hideModalDialog()"/>
            <evaluate
                    expression="rolleSuchenController.loescheRolle(rolleSuchenModel.ausgewaehlterTreffer)"/>
        </transition>
        <transition on="loeschenAbbruch" to="trefferlisteViewState">
            <evaluate expression="basisController.hideModalDialog()"/>
        </transition>
        <transition on="fertig" to="end"/>
    </view-state>

    <subflow-state id="bearbeiteRolle" subflow="rolleBearbeitenFlow">
        <input name="ausgewaehlteRolle" value="rolleSuchenModel.ausgewaehlterTreffer"
               type="de.bund.bva.isyfact.benutzerverwaltung.gui.common.model.RolleModel"/>

        <transition on="zurueck" to="trefferlisteViewState"/>
    </subflow-state>

    <end-state id="end"/>
</flow>
